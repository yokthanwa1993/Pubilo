#:schema node_modules/wrangler/config-schema.json
name = "pubilo-api"
main = "src/index.ts"
compatibility_date = "2025-01-29"
compatibility_flags = ["nodejs_compat"]

[vars]
NODE_ENV = "production"

[[d1_databases]]
binding = "DB"
database_name = "pubilo-database"
database_id = "0ebf313e-b9ca-4a41-900c-5ce2d45ef094"

[[r2_buckets]]
binding = "IMAGES"
bucket_name = "pubilo-images"

[[routes]]
pattern = "api.pubilo.com"
custom_domain = true

# Cron Triggers (UTC timezone)
# * * * * * = Every minute - Auto-post
# 0 * * * * = Every hour - Health check (alert if no posts in last hour)
# 17:00 UTC = 00:00 UTC+7 (Thailand) - Fetch earnings from Facebook
# 09:00 UTC = 16:00 UTC+7 (Thailand) - Send LINE notification
[triggers]
crons = ["* * * * *", "0 * * * *", "0 17 * * *", "0 9 * * *"]

# Rules for importing binary files
[[rules]]
type = "Data"
globs = ["**/*.ttf", "**/*.wasm"]
fallthrough = true
